<!--result.wxml-->
<view class="container">
  <text class="h1"><text class="bold">{{yearMonth}}</text>月考成绩</text>
  <text class="h2" wx:if="{{role==0}}">（{{subject=='全科'? class : (class + ' - ' +subject)}}）</text>
  <text class="h2" wx:if="{{role==1}}">（{{class + ' - ' + studentName}}）</text>

  <!-- 总体情况 -->
  <text class="title" wx:if="{{role==0 && subject!='全科'}}">— 总体情况 —</text>
  <view class="total r3" wx:if="{{role==0 && subject!='全科'}}">
    <view>最高分<text>{{maxScore}}</text></view>
    <view>最低分<text>{{minScore}}</text></view>
    <view>平均分<text>{{avgScore}}</text></view>
  </view>
  <view class="total r2" wx:if="{{role==0 && subject!='全科'}}">
    <view>优秀率<text>{{excellentRate}}%</text></view>
    <view>及格率<text>{{passingRate}}%</text></view>
  </view>

  <!-- 各班对比 -->
  <text class="title" wx:if="{{role==0 && subject!='全科'}}">— 各班对比 —</text>
  <view class="topChart" wx:if="{{role==0 && subject!='全科'}}">
    <ec-canvas id="topChart" canvas-id="topChart" ec="{{ ecTop }}"></ec-canvas>
  </view>

  <!-- 试卷分析 -->
  <text class="title" wx:if="{{role==0 && subject!='全科'}}">— 试卷分析 —</text>
  <view class="analysis" wx:if="{{role==0 && subject!='全科'}}">
      <view class="analysis-title">
        <text>标准差</text>
        <text>难度</text>
        <text>区分度</text>
      </view>
      <view class="analysis-body">
        <text>{{sqrt}}</text>
        <text>{{difficultyFactor}}</text>
        <text>{{distinction}}</text>
      </view>
      <text class="note">
  
        说明：标准差，反映成绩分布的离散程度（即均匀性）。{{description}}{{description2}}
      </text>
  </view>

  <!-- 分数段统计 -->
  <text class="title" wx:if="{{role==0 && subject!='全科'}}">— 分数段统计 —</text>
  <view class="chartWrap" wx:if="{{role==0 && subject!='全科'}}">
    <view class="tab fl-tab">
      <text class="swiper-tab-list {{tegmentedTab==0 ? 'active' : ''}}" data-type="tegmentedTab" data-current="0" data-name="tegmentedTab" bindtap="swichNav2">10分段</text>
      <text class="swiper-tab-list {{tegmentedTab==1 ? 'active' : ''}}" data-type="tegmentedTab" data-current="1" data-name="tegmentedTab" bindtap="swichNav2">20分段</text>
      <text class="swiper-tab-list {{tegmentedTab==2 ? 'active' : ''}}" data-type="tegmentedTab" data-current="2" data-name="tegmentedTab" bindtap="swichNav2">50分段</text>
    </view>
    <view class="tab">
      <text class="swiper-tab-list {{currentTab1==0 ? 'active' : ''}}" data-current="0" data-name="currentTab1" bindtap="swichNav">柱状图</text>
      <text class="swiper-tab-list {{currentTab1==1 ? 'active' : ''}}" data-current="1" data-name="currentTab1" bindtap="swichNav">饼状图</text>
    </view>
    <view class="secondChart">
      <ec-canvas id="secondChart" canvas-id="secondChart" ec="{{ ecSecond }}"></ec-canvas>
    </view>
  </view>
  
  <!-- 错题统计 -->
  <text class="title" wx:if="{{role==0 && subject!='全科'}}">— 错题统计 —</text>
  <view class="avg-error" wx:if="{{role==0 && subject!='全科'}}">平均错误率<text>{{avgWrongQuestions}}%</text></view>
  <view class="error-scale" wx:if="{{role==0 && subject!='全科'}}">
    <view class="section" wx:for="{{wrongQuestions}}" wx:key="id">
      <text>{{item.topic}}</text>
      <view class="progress-box">
        <view class="progress-bar" style="width: {{item.percentage}}">{{item.percentage}}</view>
      </view>
    </view>
  </view>

  <!-- 全对题统计 -->
  <text class="title" wx:if="{{role==0 && subject!='全科'}}">— 全对题统计 —</text>
  <view class="all-right" wx:if="{{role==0 && subject!='全科'}}">
    <text wx:if="{{allRight.length==0}}">无</text>
    <text wx:for="{{allRight}}" wx:key="id">{{item}}</text>
  </view>

  <text class="title" wx:if="{{role==0}}">— 成绩排名 —</text>
  <!-- 班主任 -->
  <view class="table" wx:if="{{role==0 && subject == '全科'}}">
    <view class="tr">
      <view class="th">姓名</view>
      <view class="th">总分</view>
      <view class="th">学校排名</view>
      <view class="th">较上次</view>
    </view>
    <view class="tr" wx:for="{{scoreArray}}" wx:key="id">
      <view class="td">{{item.studentName}}</view>
      <view class="td">{{item.totalScore}}</view>
      <view class="td">{{item.schoolRanking}}</view>
      <view class="td" wx:if="{{item.ranking == 0}}">--</view>
      <view class="td" wx:if="{{item.ranking > 0}}"><image class="up" src="/imgs/arrow_up.svg"></image>{{item.ranking}}</view>
      <view class="td" wx:if="{{item.ranking < 0}}"><image class="down" src="/imgs/arrow_down.svg"></image>{{-item.ranking}}</view>
    </view>
  </view>
  <!-- 单科老师 -->
  <view class="table" wx:if="{{role==0 && subject != '全科'}}">
    <view class="tr">
      <view class="th">姓名</view>
      <view class="th w40" style="width:{{subject == '语文' ? '80%':'40%'}}">
        {{subject+'成绩' + (subject == '语文' ? '(作文)' : '')}}
      </view>
      <view class="th">单科<text class="br"></text>学校排名</view>
      <view class="th">总分<text class="br"></text>学校排名</view>
      <view class="th w64">客观题<text class="br"></text>正确率</view>
    </view>
    <view class="tr single" wx:for="{{scoreArray}}" wx:key="id">
      <view class="td" bindtap="getStudentInfo" data-name="{{item.studentName}}">{{item.studentName}}</view>
      <view class="td w40" style="color: {{item.totalScore < pass? 'red': '#666'}};width:{{subject == '语文' ? '80%':'40%'}}">
        {{item.totalScore + (subject == '语文' ? '(' +  item.essayScore + ')' : '')}}
      </view>
      <view class="td" wx:if="{{item.ranking == 0}}">{{item.schoolRanking}}(--)</view>
      <view class="td" wx:if="{{item.ranking > 0}}">{{item.schoolRanking}}(<image class="up" src="/imgs/arrow_up.svg"></image>{{item.ranking}})</view>
      <view class="td" wx:if="{{item.ranking < 0}}">{{item.schoolRanking}}(<image class="down" src="/imgs/arrow_down.svg"></image>{{-item.ranking}})</view>
      <view class="td" wx:if="{{item.totalScoreFloatingRanking == 0}}">{{item.totalScoreRanking}}(--)</view>
      <view class="td" wx:if="{{item.totalScoreFloatingRanking > 0}}">{{item.totalScoreRanking}}(<image class="up" src="/imgs/arrow_up.svg"></image>{{item.totalScoreFloatingRanking}})</view>
      <view class="td" wx:if="{{item.totalScoreFloatingRanking < 0}}">{{item.totalScoreRanking}}(<image class="down" src="/imgs/arrow_down.svg"></image>{{-item.totalScoreFloatingRanking}})</view>
      <view class="td w64">{{item.objectiveQuestionsCorrectRate}}</view>
    </view>
  </view>
  <!-- 家长 -->
  <view class="table parantsTable" wx:if="{{role==1}}">
    <view class="tr">
      <view class="th">科目</view>
      <view class="th">成绩</view>
      <view class="th">分数区间<text class="br"></text>（年级）</view>
      <view class="th">较上次</view>
    </view>
    <view class="tr" wx:for="{{listResult}}" wx:key="id">
      <view class="td">{{item.subject}}</view>
      <view class="td">{{item.socre}}</view>
      <view class="td">前{{item.scoreRange}}%</view>
      <view class="td" wx:if="{{item.ranking == 0}}">--</view>
      <view class="td" wx:if="{{item.ranking > 0}}"><image class="up" src="/imgs/arrow_up.svg"></image>{{item.ranking}}</view>
      <view class="td" wx:if="{{item.ranking < 0}}"><image class="down" src="/imgs/arrow_down.svg"></image>{{-item.ranking}}</view>
    </view>
  </view>

  <!-- 走势图弹窗 -->
  <!-- <view class="popup" style="display:{{showTrendChart? 'block': 'none'}}; top: {{popupTop+'px'}};"> -->
  <view class="popup" style="display:{{showTrendChart? 'block': 'none'}};">
    <text class="popup-close" bindtap="closePopup">×</text>
    <text class="popup-title">学校排名走势</text>
    <text class="popup-subtitle">（{{studentName}}）</text>
    <view class="trendChart">
      <ec-canvas id="trendChart" canvas-id="trendChart" ec="{{ ecThree }}"></ec-canvas>
    </view>
  </view>

  <!-- 作文分数段统计 -->
  <text class="title" wx:if="{{role==0 && subject=='语文'}}">— 作文分数段统计 —</text>
  <view class="chartWrap" style="display:{{role==0 && subject=='语文'? 'block': 'none'}}">
    <view class="tab">
      <text class="swiper-tab-list {{currentTab2==0 ? 'active' : ''}}" data-current="0" data-name="currentTab2" bindtap="swichNav">柱状图</text>
      <text class="swiper-tab-list {{currentTab2==1 ? 'active' : ''}}" data-current="1" data-name="currentTab2" bindtap="swichNav">饼状图</text>
    </view>
    <view class="bottomChart">
      <ec-canvas id="bottomChart" canvas-id="bottomChart" ec="{{ ecBottom }}"></ec-canvas>
    </view>
  </view>
  
</view>